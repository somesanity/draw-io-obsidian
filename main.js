/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => DrawIOPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var path = __toESM(require("path"));
var fs = __toESM(require("fs"));
var import_child_process = require("child_process");
var import_buffer = require("buffer");
var DRAWIO_VIEW = "drawio-webview";
var DrawIOPlugin = class extends import_obsidian.Plugin {
  constructor() {
    super(...arguments);
    this.serveProcess = null;
  }
  async onload() {
    this.registerView(DRAWIO_VIEW, (leaf) => new DrawIOView(leaf, this));
    this.addRibbonIcon("shapes", "Open Draw.io", async () => {
      await this.launchDrawioServer();
      const leaf = this.app.workspace.getLeaf(true);
      await leaf.setViewState({
        type: DRAWIO_VIEW,
        active: true
      });
    });
    new import_obsidian.Notice("\u2705 Draw.io plugin loaded");
  }
  onunload() {
    if (this.serveProcess) {
      this.serveProcess.kill("SIGTERM");
      this.serveProcess = null;
      new import_obsidian.Notice("\u{1F6D1} Draw.io server stopped");
    }
    this.app.workspace.detachLeavesOfType(DRAWIO_VIEW);
  }
  async launchDrawioServer() {
    if (this.serveProcess)
      return;
    const vaultBasePath = this.app.vault.adapter.basePath;
    const pluginDir = path.join(vaultBasePath, this.manifest.dir);
    const webAppPath = path.join(pluginDir, "webapp");
    if (!fs.existsSync(webAppPath)) {
      new import_obsidian.Notice("\u{1F4C2} 'webapp' folder not found");
      return;
    }
    this.serveProcess = (0, import_child_process.spawn)("npx", ["serve", webAppPath, "-l", "8080"], {
      cwd: pluginDir,
      shell: true,
      detached: false
    });
    await new Promise((res) => setTimeout(res, 1e3));
  }
};
var DrawIOView = class extends import_obsidian.ItemView {
  constructor(leaf, plugin) {
    super(leaf);
    this.plugin = plugin;
  }
  getViewType() {
    return DRAWIO_VIEW;
  }
  getDisplayText() {
    return "Draw.io";
  }
  getIcon() {
    return "shapes";
  }
  async onOpen() {
    const container = this.containerEl.children[1];
    container.empty();
    const iframe = container.createEl("iframe", {
      attr: {
        src: "http://localhost:8080/?embed=1&proto=json&libraries=1&spin=1&ui=dark&dark=1&splash=0",
        style: "width: 100%; height: 100%; border: none;"
      }
    });
    const messageHandler = async (event) => {
      const origin = event.origin;
      if (origin !== "http://localhost:8080")
        return;
      let msg;
      try {
        msg = typeof event.data === "string" ? JSON.parse(event.data) : event.data;
      } catch (e) {
        console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F \u043E\u0442 Draw.io:", e);
        return;
      }
      await handleDrawioMessage(msg, event.source, this.app);
    };
    window.addEventListener("message", messageHandler);
    this.register(() => {
      window.removeEventListener("message", messageHandler);
    });
  }
  async onClose() {
  }
};
async function saveDrawioSvgToVault(app, fileName, svgContent) {
  const folderPath = "Drawio";
  const fullPath = `${folderPath}/${fileName}.svg`;
  let contentToSave;
  if (svgContent.startsWith("data:image/svg+xml;base64,")) {
    try {
      const base64Part = svgContent.split(",")[1];
      contentToSave = import_buffer.Buffer.from(base64Part, "base64").toString("utf-8");
      console.log("SVG content decoded successfully.");
    } catch (e) {
      new import_obsidian.Notice("\u274C Failed to decode SVG content.");
      console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0434\u0435\u043A\u043E\u0434\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F SVG:", e);
      contentToSave = svgContent;
    }
  } else {
    contentToSave = svgContent;
  }
  try {
    const folder = app.vault.getAbstractFileByPath(folderPath);
    if (!folder) {
      await app.vault.createFolder(folderPath);
    }
  } catch (err) {
    console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u043F\u0430\u043F\u043A\u0438:", err);
  }
  const existingFile = app.vault.getAbstractFileByPath(fullPath);
  if (existingFile instanceof import_obsidian.TFile) {
    await app.vault.modify(existingFile, contentToSave);
  } else {
    await app.vault.create(fullPath, contentToSave);
  }
  new import_obsidian.Notice("\u{1F4BE} Diagram saved as editable SVG: " + fullPath);
}
async function handleDrawioMessage(msg, sourceWindow, app) {
  console.log("\u{1F4E9} Message from Draw.io:", msg);
  switch (msg.event) {
    case "init":
      sourceWindow.postMessage(
        JSON.stringify({
          action: "load",
          xml: "<mxGraphModel><root></root></mxGraphModel>",
          autosave: 1
        }),
        "http://localhost:8080"
      );
      break;
    case "save":
      sourceWindow.postMessage(
        JSON.stringify({
          action: "export",
          format: "xmlsvg",
          xml: true
        }),
        "http://localhost:8080"
      );
      break;
    case "export":
      console.log("\u{1F5BC} Exported data received", msg.data);
      await saveDrawioSvgToVault(app, "diagram.drawio", msg.data);
      break;
    case "change":
      console.log("\u{1F300} Diagram changed");
      break;
    case "exit":
      console.log("\u{1F44B} User exited Draw.io");
      break;
    case "ready":
      console.log("\u2705 Draw.io is ready");
      break;
    case "error":
      console.error("\u274C Error from Draw.io:", msg.message);
      break;
    case "load":
    case "configure":
      break;
  }
}
// Annotate the CommonJS export names for ESM import in node:
0 && (module.exports = {});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgUGx1Z2luLCBXb3Jrc3BhY2VMZWFmLCBJdGVtVmlldywgTm90aWNlLCBBcHAsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZnNcIjtcbmltcG9ydCB7IHNwYXduLCBDaGlsZFByb2Nlc3NXaXRob3V0TnVsbFN0cmVhbXMgfSBmcm9tIFwiY2hpbGRfcHJvY2Vzc1wiO1xuaW1wb3J0IHsgQnVmZmVyIH0gZnJvbSAnYnVmZmVyJztcblxuY29uc3QgRFJBV0lPX1ZJRVcgPSBcImRyYXdpby13ZWJ2aWV3XCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERyYXdJT1BsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG5cdHByaXZhdGUgc2VydmVQcm9jZXNzOiBDaGlsZFByb2Nlc3NXaXRob3V0TnVsbFN0cmVhbXMgfCBudWxsID0gbnVsbDtcblxuXHRhc3luYyBvbmxvYWQoKSB7XG5cdFx0dGhpcy5yZWdpc3RlclZpZXcoRFJBV0lPX1ZJRVcsIChsZWFmKSA9PiBuZXcgRHJhd0lPVmlldyhsZWFmLCB0aGlzKSk7XG5cblx0XHR0aGlzLmFkZFJpYmJvbkljb24oXCJzaGFwZXNcIiwgXCJPcGVuIERyYXcuaW9cIiwgYXN5bmMgKCkgPT4ge1xuXHRcdFx0YXdhaXQgdGhpcy5sYXVuY2hEcmF3aW9TZXJ2ZXIoKTtcblxuXHRcdFx0Y29uc3QgbGVhZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKHRydWUpO1xuXHRcdFx0YXdhaXQgbGVhZi5zZXRWaWV3U3RhdGUoe1xuXHRcdFx0XHR0eXBlOiBEUkFXSU9fVklFVyxcblx0XHRcdFx0YWN0aXZlOiB0cnVlLFxuXHRcdFx0fSk7XG5cdFx0fSk7XG5cblx0XHRuZXcgTm90aWNlKFwiXHUyNzA1IERyYXcuaW8gcGx1Z2luIGxvYWRlZFwiKTtcblx0fVxuXG5cdG9udW5sb2FkKCkge1xuXHRcdGlmICh0aGlzLnNlcnZlUHJvY2Vzcykge1xuXHRcdFx0dGhpcy5zZXJ2ZVByb2Nlc3Mua2lsbChcIlNJR1RFUk1cIik7XG5cdFx0XHR0aGlzLnNlcnZlUHJvY2VzcyA9IG51bGw7XG5cdFx0XHRuZXcgTm90aWNlKFwiXHVEODNEXHVERUQxIERyYXcuaW8gc2VydmVyIHN0b3BwZWRcIik7XG5cdFx0fVxuXG5cdFx0dGhpcy5hcHAud29ya3NwYWNlLmRldGFjaExlYXZlc09mVHlwZShEUkFXSU9fVklFVyk7XG5cdH1cblxuXHRwcml2YXRlIGFzeW5jIGxhdW5jaERyYXdpb1NlcnZlcigpIHtcblx0XHRpZiAodGhpcy5zZXJ2ZVByb2Nlc3MpIHJldHVybjtcblxuXHRcdGNvbnN0IHZhdWx0QmFzZVBhdGggPSAodGhpcy5hcHAudmF1bHQuYWRhcHRlciBhcyBhbnkpLmJhc2VQYXRoIGFzIHN0cmluZztcblx0XHRjb25zdCBwbHVnaW5EaXIgPSBwYXRoLmpvaW4odmF1bHRCYXNlUGF0aCwgdGhpcy5tYW5pZmVzdC5kaXIhKTtcblx0XHRjb25zdCB3ZWJBcHBQYXRoID0gcGF0aC5qb2luKHBsdWdpbkRpciwgXCJ3ZWJhcHBcIik7XG5cblx0XHRpZiAoIWZzLmV4aXN0c1N5bmMod2ViQXBwUGF0aCkpIHtcblx0XHRcdG5ldyBOb3RpY2UoXCJcdUQ4M0RcdURDQzIgJ3dlYmFwcCcgZm9sZGVyIG5vdCBmb3VuZFwiKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHR0aGlzLnNlcnZlUHJvY2VzcyA9IHNwYXduKFwibnB4XCIsIFtcInNlcnZlXCIsIHdlYkFwcFBhdGgsIFwiLWxcIiwgXCI4MDgwXCJdLCB7XG5cdFx0XHRjd2Q6IHBsdWdpbkRpcixcblx0XHRcdHNoZWxsOiB0cnVlLFxuXHRcdFx0ZGV0YWNoZWQ6IGZhbHNlLFxuXHRcdH0pO1xuXG5cdFx0YXdhaXQgbmV3IFByb21pc2UoKHJlcykgPT4gc2V0VGltZW91dChyZXMsIDEwMDApKTtcblx0fVxufVxuXG5jbGFzcyBEcmF3SU9WaWV3IGV4dGVuZHMgSXRlbVZpZXcge1xuXHRwcml2YXRlIHBsdWdpbjogRHJhd0lPUGx1Z2luO1xuXG5cdGNvbnN0cnVjdG9yKGxlYWY6IFdvcmtzcGFjZUxlYWYsIHBsdWdpbjogRHJhd0lPUGx1Z2luKSB7XG5cdFx0c3VwZXIobGVhZik7XG5cdFx0dGhpcy5wbHVnaW4gPSBwbHVnaW47XG5cdH1cblxuXHRnZXRWaWV3VHlwZSgpOiBzdHJpbmcge1xuXHRcdHJldHVybiBEUkFXSU9fVklFVztcblx0fVxuXG5cdGdldERpc3BsYXlUZXh0KCk6IHN0cmluZyB7XG5cdFx0cmV0dXJuIFwiRHJhdy5pb1wiO1xuXHR9XG5cblx0Z2V0SWNvbigpOiBzdHJpbmcge1xuXHRcdHJldHVybiBcInNoYXBlc1wiO1xuXHR9XG5cblx0YXN5bmMgb25PcGVuKCkge1xuXHRcdGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyRWwuY2hpbGRyZW5bMV07XG5cdFx0Y29udGFpbmVyLmVtcHR5KCk7XG5cblx0XHRjb25zdCBpZnJhbWUgPSBjb250YWluZXIuY3JlYXRlRWwoXCJpZnJhbWVcIiwge1xuXHRcdFx0YXR0cjoge1xuXHRcdFx0XHRzcmM6IFwiaHR0cDovL2xvY2FsaG9zdDo4MDgwLz9lbWJlZD0xJnByb3RvPWpzb24mbGlicmFyaWVzPTEmc3Bpbj0xJnVpPWRhcmsmZGFyaz0xJnNwbGFzaD0wXCIsXG5cdFx0XHRcdHN0eWxlOiBcIndpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7IGJvcmRlcjogbm9uZTtcIixcblx0XHRcdH0sXG5cdFx0fSk7XG5cblx0XHRjb25zdCBtZXNzYWdlSGFuZGxlciA9IGFzeW5jIChldmVudDogTWVzc2FnZUV2ZW50KSA9PiB7XG5cdFx0XHRjb25zdCBvcmlnaW4gPSBldmVudC5vcmlnaW47XG5cdFx0XHRpZiAob3JpZ2luICE9PSBcImh0dHA6Ly9sb2NhbGhvc3Q6ODA4MFwiKSByZXR1cm47XG5cblx0XHRcdGxldCBtc2c7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRtc2cgPSB0eXBlb2YgZXZlbnQuZGF0YSA9PT0gXCJzdHJpbmdcIiA/IEpTT04ucGFyc2UoZXZlbnQuZGF0YSkgOiBldmVudC5kYXRhO1xuXHRcdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0XHRjb25zb2xlLmVycm9yKFwiXHUwNDFFXHUwNDQ4XHUwNDM4XHUwNDMxXHUwNDNBXHUwNDMwIFx1MDQzRlx1MDQzMFx1MDQ0MFx1MDQ0MVx1MDQzOFx1MDQzRFx1MDQzM1x1MDQzMCBcdTA0NDFcdTA0M0VcdTA0M0VcdTA0MzFcdTA0NDlcdTA0MzVcdTA0M0RcdTA0MzhcdTA0NEYgXHUwNDNFXHUwNDQyIERyYXcuaW86XCIsIGUpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGF3YWl0IGhhbmRsZURyYXdpb01lc3NhZ2UobXNnLCBldmVudC5zb3VyY2UgYXMgV2luZG93LCB0aGlzLmFwcCk7XG5cdFx0fTtcblxuXHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBtZXNzYWdlSGFuZGxlcik7XG5cblx0XHR0aGlzLnJlZ2lzdGVyKCgpID0+IHtcblx0XHRcdHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBtZXNzYWdlSGFuZGxlcik7XG5cdFx0fSk7XG5cdH1cblxuXHRhc3luYyBvbkNsb3NlKCkge1xuXHRcdC8vIFx1MDQxQ1x1MDQzRVx1MDQzNlx1MDQzRFx1MDQzRSBcdTA0MzRcdTA0M0VcdTA0MzFcdTA0MzBcdTA0MzJcdTA0MzhcdTA0NDJcdTA0NEMgXHUwNDNFXHUwNDQ3XHUwNDM4XHUwNDQxXHUwNDQyXHUwNDNBXHUwNDQzLCBcdTA0MzVcdTA0NDFcdTA0M0JcdTA0MzggXHUwNDNEXHUwNDQzXHUwNDM2XHUwNDNEXHUwNDNFXG5cdH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gc2F2ZURyYXdpb1N2Z1RvVmF1bHQoYXBwOiBBcHAsIGZpbGVOYW1lOiBzdHJpbmcsIHN2Z0NvbnRlbnQ6IHN0cmluZykge1xuICAgIGNvbnN0IGZvbGRlclBhdGggPSBcIkRyYXdpb1wiOyBcbiAgICBjb25zdCBmdWxsUGF0aCA9IGAke2ZvbGRlclBhdGh9LyR7ZmlsZU5hbWV9LnN2Z2A7IC8vIFx1MDQyMFx1MDQzMFx1MDQ0MVx1MDQ0OFx1MDQzOFx1MDQ0MFx1MDQzNVx1MDQzRFx1MDQzOFx1MDQzNSAuc3ZnXG5cbiAgICBsZXQgY29udGVudFRvU2F2ZTogc3RyaW5nO1xuXG4gICAgLy8gXHUwNDFGXHUwNDQwXHUwNDNFXHUwNDMyXHUwNDM1XHUwNDQwXHUwNDRGXHUwNDM1XHUwNDNDLCBcdTA0NEZcdTA0MzJcdTA0M0JcdTA0NEZcdTA0MzVcdTA0NDJcdTA0NDFcdTA0NEYgXHUwNDNCXHUwNDM4IFx1MDQ0MVx1MDQzRVx1MDQzNFx1MDQzNVx1MDQ0MFx1MDQzNlx1MDQzOFx1MDQzQ1x1MDQzRVx1MDQzNSBEYXRhIFVSTFxuICAgIGlmIChzdmdDb250ZW50LnN0YXJ0c1dpdGgoXCJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFwiKSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgYmFzZTY0UGFydCA9IHN2Z0NvbnRlbnQuc3BsaXQoJywnKVsxXTtcbiAgICAgICAgICAgIC8vIFx1MDQxNFx1MDQzNVx1MDQzQVx1MDQzRVx1MDQzNFx1MDQzOFx1MDQ0MFx1MDQ0M1x1MDQzNVx1MDQzQyBCYXNlNjQgXHUwNDMyIFx1MDQ0MVx1MDQ0Mlx1MDQ0MFx1MDQzRVx1MDQzQVx1MDQ0M1xuICAgICAgICAgICAgLy8gXHUwNDEyIFx1MDQzRVx1MDQzQVx1MDQ0MFx1MDQ0M1x1MDQzNlx1MDQzNVx1MDQzRFx1MDQzOFx1MDQzOCBPYnNpZGlhbi9Ob2RlLmpzIFx1MDQzQlx1MDQ0M1x1MDQ0N1x1MDQ0OFx1MDQzNSBcdTA0MzhcdTA0NDFcdTA0M0ZcdTA0M0VcdTA0M0JcdTA0NENcdTA0MzdcdTA0M0VcdTA0MzJcdTA0MzBcdTA0NDJcdTA0NEMgQnVmZmVyXG4gICAgICAgICAgICBjb250ZW50VG9TYXZlID0gQnVmZmVyLmZyb20oYmFzZTY0UGFydCwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCd1dGYtOCcpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBcdTA0MTVcdTA0NDFcdTA0M0JcdTA0MzggQnVmZmVyIFx1MDQzRFx1MDQzNVx1MDQzNFx1MDQzRVx1MDQ0MVx1MDQ0Mlx1MDQ0M1x1MDQzRlx1MDQzNVx1MDQzRCAoXHUwNDNEXHUwNDMwXHUwNDNGXHUwNDQwXHUwNDM4XHUwNDNDXHUwNDM1XHUwNDQwLCBcdTA0MzIgXHUwNDQ3XHUwNDM4XHUwNDQxXHUwNDQyXHUwNDNFXHUwNDNDIFx1MDQzMVx1MDQ0MFx1MDQzMFx1MDQ0M1x1MDQzN1x1MDQzNVx1MDQ0MFx1MDQzNSBcdTA0MzFcdTA0MzVcdTA0MzcgcG9seWZpbGwpLCBcdTA0MzhcdTA0NDFcdTA0M0ZcdTA0M0VcdTA0M0JcdTA0NENcdTA0MzdcdTA0NDNcdTA0MzlcdTA0NDJcdTA0MzUgYXRvYjpcbiAgICAgICAgICAgIC8vIGNvbnRlbnRUb1NhdmUgPSBhdG9iKGJhc2U2NFBhcnQpOyBcblxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJTVkcgY29udGVudCBkZWNvZGVkIHN1Y2Nlc3NmdWxseS5cIik7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJcdTI3NEMgRmFpbGVkIHRvIGRlY29kZSBTVkcgY29udGVudC5cIik7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiXHUwNDFFXHUwNDQ4XHUwNDM4XHUwNDMxXHUwNDNBXHUwNDMwIFx1MDQzNFx1MDQzNVx1MDQzQVx1MDQzRVx1MDQzNFx1MDQzOFx1MDQ0MFx1MDQzRVx1MDQzMlx1MDQzMFx1MDQzRFx1MDQzOFx1MDQ0RiBTVkc6XCIsIGUpO1xuICAgICAgICAgICAgY29udGVudFRvU2F2ZSA9IHN2Z0NvbnRlbnQ7IC8vIFx1MDQyMVx1MDQzRVx1MDQ0NVx1MDQ0MFx1MDQzMFx1MDQzRFx1MDQ0Rlx1MDQzNVx1MDQzQyBcdTA0M0FcdTA0MzBcdTA0M0EgXHUwNDM1XHUwNDQxXHUwNDQyXHUwNDRDLCBcdTA0MzVcdTA0NDFcdTA0M0JcdTA0MzggXHUwNDM0XHUwNDM1XHUwNDNBXHUwNDNFXHUwNDM0XHUwNDM4XHUwNDQwXHUwNDNFXHUwNDMyXHUwNDMwXHUwNDNEXHUwNDM4XHUwNDM1IFx1MDQzRFx1MDQzNSBcdTA0NDNcdTA0MzRcdTA0MzBcdTA0M0JcdTA0M0VcdTA0NDFcdTA0NENcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnRlbnRUb1NhdmUgPSBzdmdDb250ZW50OyAvLyBcdTA0MTVcdTA0NDFcdTA0M0JcdTA0MzggXHUwNDREXHUwNDQyXHUwNDNFIFx1MDQ0M1x1MDQzNlx1MDQzNSBcdTA0M0RcdTA0MzUgRGF0YSBVUkwsIFx1MDQ0MVx1MDQzRVx1MDQ0NVx1MDQ0MFx1MDQzMFx1MDQzRFx1MDQ0Rlx1MDQzNVx1MDQzQyBcdTA0M0FcdTA0MzBcdTA0M0EgXHUwNDM1XHUwNDQxXHUwNDQyXHUwNDRDXG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZm9sZGVyID0gYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChmb2xkZXJQYXRoKTtcbiAgICAgICAgaWYgKCFmb2xkZXIpIHtcbiAgICAgICAgICAgIGF3YWl0IGFwcC52YXVsdC5jcmVhdGVGb2xkZXIoZm9sZGVyUGF0aCk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlx1MDQxRVx1MDQ0OFx1MDQzOFx1MDQzMVx1MDQzQVx1MDQzMCBcdTA0NDFcdTA0M0VcdTA0MzdcdTA0MzRcdTA0MzBcdTA0M0RcdTA0MzhcdTA0NEYgXHUwNDNGXHUwNDMwXHUwNDNGXHUwNDNBXHUwNDM4OlwiLCBlcnIpO1xuICAgIH1cblxuICAgIGNvbnN0IGV4aXN0aW5nRmlsZSA9IGFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZnVsbFBhdGgpO1xuICAgIGlmIChleGlzdGluZ0ZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICBhd2FpdCBhcHAudmF1bHQubW9kaWZ5KGV4aXN0aW5nRmlsZSwgY29udGVudFRvU2F2ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgYXdhaXQgYXBwLnZhdWx0LmNyZWF0ZShmdWxsUGF0aCwgY29udGVudFRvU2F2ZSk7XG4gICAgfVxuXG4gICAgbmV3IE5vdGljZShcIlx1RDgzRFx1RENCRSBEaWFncmFtIHNhdmVkIGFzIGVkaXRhYmxlIFNWRzogXCIgKyBmdWxsUGF0aCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZURyYXdpb01lc3NhZ2UobXNnOiBhbnksIHNvdXJjZVdpbmRvdzogV2luZG93LCBhcHA6IEFwcCkge1xuXHRjb25zb2xlLmxvZyhcIlx1RDgzRFx1RENFOSBNZXNzYWdlIGZyb20gRHJhdy5pbzpcIiwgbXNnKTtcblxuXHRzd2l0Y2ggKG1zZy5ldmVudCkge1xuXHRcdGNhc2UgXCJpbml0XCI6XG5cdFx0XHRzb3VyY2VXaW5kb3cucG9zdE1lc3NhZ2UoXG5cdFx0XHRcdEpTT04uc3RyaW5naWZ5KHtcblx0XHRcdFx0XHRhY3Rpb246IFwibG9hZFwiLFxuXHRcdFx0XHRcdHhtbDogXCI8bXhHcmFwaE1vZGVsPjxyb290Pjwvcm9vdD48L214R3JhcGhNb2RlbD5cIixcblx0XHRcdFx0XHRhdXRvc2F2ZTogMSxcblx0XHRcdFx0fSksXG5cdFx0XHRcdFwiaHR0cDovL2xvY2FsaG9zdDo4MDgwXCJcblx0XHRcdCk7XG5cdFx0XHRicmVhaztcblxuXHRcdGNhc2UgXCJzYXZlXCI6XG5cdFx0XHRzb3VyY2VXaW5kb3cucG9zdE1lc3NhZ2UoXG5cdFx0XHRcdEpTT04uc3RyaW5naWZ5KHtcblx0XHRcdFx0XHRhY3Rpb246IFwiZXhwb3J0XCIsXG5cdFx0XHRcdFx0Zm9ybWF0OiBcInhtbHN2Z1wiLCBcblx0XHRcdFx0XHR4bWw6IHRydWUsXG5cdFx0XHRcdH0pLFxuXHRcdFx0XHRcImh0dHA6Ly9sb2NhbGhvc3Q6ODA4MFwiXG5cdFx0XHQpO1xuXHRcdFx0YnJlYWs7XG5cblx0XHRjYXNlIFwiZXhwb3J0XCI6XG5cdFx0XHRjb25zb2xlLmxvZyhcIlx1RDgzRFx1RERCQyBFeHBvcnRlZCBkYXRhIHJlY2VpdmVkXCIsIG1zZy5kYXRhKTtcblx0XHRcdGF3YWl0IHNhdmVEcmF3aW9TdmdUb1ZhdWx0KGFwcCwgXCJkaWFncmFtLmRyYXdpb1wiLCBtc2cuZGF0YSk7XG5cdFx0XHRicmVhaztcblxuXHRcdGNhc2UgXCJjaGFuZ2VcIjpcblx0XHRcdGNvbnNvbGUubG9nKFwiXHVEODNDXHVERjAwIERpYWdyYW0gY2hhbmdlZFwiKTtcblx0XHRcdGJyZWFrO1xuXG5cdFx0Y2FzZSBcImV4aXRcIjpcblx0XHRcdGNvbnNvbGUubG9nKFwiXHVEODNEXHVEQzRCIFVzZXIgZXhpdGVkIERyYXcuaW9cIik7XG5cdFx0XHRicmVhaztcblxuXHRcdGNhc2UgXCJyZWFkeVwiOlxuXHRcdFx0Y29uc29sZS5sb2coXCJcdTI3MDUgRHJhdy5pbyBpcyByZWFkeVwiKTtcblx0XHRcdGJyZWFrO1xuXG5cdFx0Y2FzZSBcImVycm9yXCI6XG5cdFx0XHRjb25zb2xlLmVycm9yKFwiXHUyNzRDIEVycm9yIGZyb20gRHJhdy5pbzpcIiwgbXNnLm1lc3NhZ2UpO1xuXHRcdFx0YnJlYWs7XG5cblx0XHQvLyBPcHRpb25hbCBmdXR1cmUgaGFuZGxlcnNcblx0XHRjYXNlIFwibG9hZFwiOlxuXHRcdGNhc2UgXCJjb25maWd1cmVcIjpcblx0XHRcdGJyZWFrO1xuXHR9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLHNCQUFvRTtBQUNwRSxXQUFzQjtBQUN0QixTQUFvQjtBQUNwQiwyQkFBc0Q7QUFDdEQsb0JBQXVCO0FBRXZCLElBQU0sY0FBYztBQUVwQixJQUFxQixlQUFyQixjQUEwQyx1QkFBTztBQUFBLEVBQWpEO0FBQUE7QUFDQyxTQUFRLGVBQXNEO0FBQUE7QUFBQSxFQUU5RCxNQUFN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
